<%@page import="java.util.List"%>

<%@page import="adm.alumno.spring.AdmTutor"%>
<%@page import="adm.alumno.spring.AdmAcademico"%>
<%@page import="adm.alumno.spring.AdmPadres"%>
<%@page import="adm.alumno.spring.AdmSolicitud"%>
<%@page import="adm.catalogo.spring.CatPais"%>
<%@page import="adm.catalogo.spring.CatEstado"%>
<%@page import="adm.catalogo.spring.CatCiudad"%>
<%@page import="adm.alumno.spring.AdmCartaSubir"%>

<%@ include file= "../head.jsp"%>
<%@ include file= "../menu.jsp"%>

<html>
<head>
	<link rel="STYLESHEET" href="/admision.css"  type="text/css">
	<script src="js/jquery-1.5.1.min.js" type="text/javascript"></script>
  	<script src='js/Globo/jquery.tinyTips2.js' type='text/javascript'></script>		
	<style>		
		body{
			background-image: url("<%=request.getContextPath()%>/imagenes/Biblioteca.png");
			/* Para dejar la imagen de fondo centrada, vertical y horizontalmente */
			background-position: center center;
			/* La imagen se fija en la ventana de visualizaci�n para que la altura de la imagen no supere a la del contenido */
			background-attachment: fixed;
			background-repeat: no-repeat;
			/* La imagen de fondo se reescala autom�ticamente con el cambio del ancho de ventana del navegador */
			background-size: cover;	
		} 
		a {text-decoration: none;} 
		a:hover {text-decoration: underline;} 
		.tabla td{padding:5px;}
		
		.tinyTip {
			width: 325px;
			padding: 17px 0px 0px 0px;
			display: block;
			background: url(js/Globo/tinyTip-top.png) 0px 0px no-repeat;
		}
		.tinyTip .content {
			padding: 0px 15px 0px 15px;
			font-size: 14px;
			font-family: "Lucida Sans Unicode";
			color: #010101;
			background: url(js/Globo/tinyTip-content.png) 0px 0px repeat-y;
		}
		.tinyTip .bottom {
			height: 47px;
			background: url(js/Globo/tinyTip-bottom.png) 0px 0px no-repeat;
			font: 0px/0px sans-serif;
		}
		.fa{
			color: black;
		}
		a> .fa{
			color: #337ab7;
		}
		
		@media (min-width: 587px) {
			.col-md-3{
				float: left;
				margin-left: 85px;
			}
		}
		@media (min-width: 764px) {
			.col-md-3{
				float: left;
				margin-left: 0;
			}		
		}
		@media (min-width: 480px) {
			.col-md-5{
				float: left;
			}
		}	
	</style>	
	<script>	
 	window.onload = function() {
    	document.getElementById("divMexico").style.display = "block";
 		document.getElementById("divNoMexico").style.display = "none";
	};
	
		function revisa(){
			if(document.getElementById("nombreTutor").value != ""){
				if(document.getElementById("calleTutor").value != ""){
					if(document.getElementById("numeroTutor").value != ""){
						if(document.getElementById("coloniaTutor").value != ""){
							if(document.getElementById("codigoPostalTutor").value != ""){
								if(document.getElementById("nacPais").value != "0"){
									if((document.getElementById("nacPais").value=="91"&&document.getElementById("nacEdo").value!="0") || document.getElementById("Estado").value!=""){
										if((document.getElementById("nacPais").value=="91"&&document.getElementById("nacCiudad").value!="0") || document.getElementById("Ciudad").value!=""){
											if(document.getElementById("telefonoTutor").value!="0" && document.getElementById("telefonoTutor").value.length>=10){
												return true;
											}
											else{
												alert("El tel�fono es incorrecto, escriba por lo menos 10 d�gitos");
												document.getElementById("telefonoTutor").focus();
											}
										}
										else{
											alert("La ciudad es requerida");
											document.getElementById("nacCiudad").focus();
										}
									}
									else{
										alert("El estado es requerido");
										document.getElementById("nacEdo").focus();	
									}
								}
								else{
									alert("El pa�s es requerido");
									document.getElementById("nacPais").focus();
								}
							}
							else{
								alert("El c�digo postal es requerida");
								document.getElementById("codigoPostalTutor").focus();
							}
						}
						else{
							alert("La colonia es requerida");
							document.getElementById("coloniaTutor").focus();
						}
					}
					else{
						alert("El n�mero es requerido");
						document.getElementById("numeroTutor").focus();
					}
				}
				else{
					alert("La calle es requerida");
					document.getElementById("calleTutor").focus();	
				}
			}
			else{
				alert("El nombre es requerido");
				document.getElementById("nombreTutor").focus();
			}
			return false;
		}
		
		function grabar(){
			if(revisa()){
				document.formTutor.submit();
			}
		}

		function cambioPais(){
			var paisId = document.getElementById("nacPais").value;
			
			if(paisId === "91"){
				document.getElementById("nacEdo").value = "0";
				document.getElementById("nacCiudad").value = "0";
				
			    document.getElementById("divMexico").style.display = "block";
		 		document.getElementById("divNoMexico").style.display = "none";
			}else{
				document.getElementById("Estado").value = "-";
				document.getElementById("Ciudad").value = "-";

				document.getElementById("divMexico").style.display = "none";
		 		document.getElementById("divNoMexico").style.display = "block";
			}
			
		}
	</script>
</head>
<%	
	String folio 			= (String)session.getAttribute("Folio")==null?"0":(String)session.getAttribute("Folio");
	String disabled 		= "";
	String grabo 			= request.getParameter("Grabo")==null?"-":request.getParameter("Grabo");
	boolean existeTutor 	= (boolean)request.getAttribute("existeTutor");	
	String colorGrabar		= existeTutor?"style='color:purple'":"style='color:orange'";

	AdmTutor tutor 				= (AdmTutor)request.getAttribute("tutor");
	AdmAcademico academico 		= (AdmAcademico)request.getAttribute("academico");
	AdmPadres padres 			= (AdmPadres)request.getAttribute("padres");
	AdmSolicitud solicitud 		= (AdmSolicitud)request.getAttribute("solicitud");
	AdmCartaSubir admCartaSubir = (AdmCartaSubir)request.getAttribute("admCartaSubir");

	List<CatPais> lisPais		= (List<CatPais>)request.getAttribute("lisPais");
	List<CatEstado> lisEstados	= (List<CatEstado>)request.getAttribute("lisEstados");
	List<CatCiudad> lisCiudades	= (List<CatCiudad>)request.getAttribute("lisCiudades");
	//System.out.println("Datos:"+tutor.getCiudad()+":"+tutor.getEstado()+":"+existeTutor);
%>
<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-lg-1" style="background-color:rgba(255, 255, 255, 0.7);">
			<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/registro" style="color:black">					
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Datos usuario"><i class="fas fa-user fa-2x"></i><br>Cuenta</span>&nbsp;
				</a>
			</span>
			<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/solicitud/modalidad" style="color:black">					
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Solicitud de admisi�n"><i class="far fa-file-alt fa-2x"></i><br>Solicitud</span>&nbsp;
				</a>
			</span>			
			<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/documentos/documentos" style="color:black">					
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Documentos de ingreso"><i class="fas fa-tasks fa-2x"></i><br>Documentos</span>&nbsp;
				</a>
			</span>					
			<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/directo/ingreso" style="color:black">
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Ingreso directo"><i class="fas fa-door-open fa-2x"></i><br>Ingreso</span>&nbsp;
				</a>
			</span>					
			<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/referencias?Folio=<%=folio%>" style="color:black">
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Pago en linea"><i class="fas fa-credit-card fa-2x"></i><br>Pago</span>&nbsp;
				</a>
			</span>					
			<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/cita/evento" style="color:black">
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Reservar examen"><i class="far fa-calendar-alt fa-2x"></i><br>Examen</span>&nbsp;
				</a>
			</span>					
			<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
				<a href="<%=request.getContextPath()%>/resultados/resultados" style="color:black">
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Resultados examen"><i class="fas fa-trophy fa-2x"></i><br>Resultados</span>&nbsp;
				</a>
			</span>					
			<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
<% 				String colorCarta = "black";
				if(admCartaSubir.getCarta() != null){	
					colorCarta = "green";										
 				}%>												
				<a href="<%=request.getContextPath()%>/descargarCartaAdmision" style="color:<%=colorCarta%>">
					<span data-bs-toggle="tooltip" data-bs-placement="right" title="Carta de admision"><i class="fas fa-envelope fa-2x"></i><br>Carta</span>&nbsp;
				</a>
			</span>					
		</div>
		<div class="col-lg-11" style="background-color:white; min-height:calc(100vh - 37px);">
			<div class="d-flex bd-highlight page-header">
				<div class="p-2 w-100 bd-highlight">
					<h2><i class="fas fa-check-circle" aria-hidden="true" <%=colorGrabar%>></i>&nbsp;<spring:message code="solicitud.tutor.InfoTutor"/></h2>
				</div>
				<div class="p-2 flex-shrink-1 bd-highlight">
					<div class="d-flex align-items-center">
			    		<a href="<%=request.getContextPath()%>/solicitud/salud"><i class="fas fa-caret-left fa-3x"></i></a>
			    		&nbsp;<b class="fs-5">6/8</b>&nbsp;
<%				if(existeTutor){%>
						<a href="<%=request.getContextPath()%>/solicitud/recomendaciones"><i class="fas fa-caret-right fa-3x"></i></a>
<%				} %>
					</div>
				</div>
			</div>
			<div class="alert alert-info" role="alert">
				<p><spring:message code="solicitud.tutor.IntroDatos"/>:</p>
			</div>		
			<form id="formTutor" name="formTutor" method="post" action="grabaTutor">
				<div class="row">			
					<div class="col">		    	
						<label><spring:message code="solicitud.tutor.Tutor"/>:</label>
		       			<select class="form-select" id="tutor" name="tutor" onChange="window.location.href='tutor?tut='+document.formTutor.tutor.value">
<%								String tutorId = request.getParameter("tut")==null ? "0" : request.getParameter("tut");
							if(request.getParameter("tut")==null && (tutor.getTutor()!=null && !tutor.getTutor().equals(""))){
								tutorId = tutor.getTutor();
							}%>
							<option value="0" <%="0".equals(tutorId) ? "Selected" : "" %>>Padre</option>
							<option value="1" <%="1".equals(tutorId) ? "Selected" : "" %>>Madre</option>
							<option value="3" <%="3".equals(tutorId) ? "Selected" : "" %>>Otro</option>
			        	</select><br>
			        	<label><spring:message code="solicitud.tutor.ApellidoNombre"/>:</label>
<%								String informacion = "";
		    				if(tutorId.equals("0") || tutorId.equals("1")){
		    					disabled = "disabled";
			    				if(tutorId.equals("0")){
			    					informacion = padres.getPadreNombre()==null ? "" : padres.getPadreNombre()+" "+padres.getPadreApellido();
			    				}else{
			    					informacion = padres.getMadreNombre()==null ? "" : padres.getMadreNombre()+" "+padres.getMadreApellido();
			    				}
		    				}else if(tutorId.equals("2")){
			    				disabled = "disabled";
			    				informacion = solicitud.getNombre()+" "+solicitud.getApellidoPaterno()+" "+solicitud.getApellidoMaterno();
			    			}else{
			    				informacion = tutor.getNombre()==null ? "" : tutor.getNombre();
	    					}%> 
			    		<input class="form-control" type="text" id="nombreTutor" name="nombreTutor" value="<%=informacion %>" size="30" maxlength="100" <%=disabled %>/><br>
			    		<label><spring:message code="solicitud.tutor.Calle"/>:</label>
			    		<input class="form-control" type="text" id="calleTutor" name="calleTutor" value="<%=tutor.getCalle() %>" size="30" maxlength="50" /><br>
			    		<label><spring:message code="solicitud.tutor.Numero"/>:</label>
			    		<b>#</b><input class="form-control" type="text" id="numeroTutor" name="numeroTutor" value="<%=tutor.getNumero() %>" size="30" maxlength="20" /><br>
			    		<label><spring:message code="solicitud.tutor.Colonia"/>:</label>
			    		<input class="form-control" type="text" id="coloniaTutor" name="coloniaTutor" value="<%=tutor.getColonia() %>" size="30" maxlength="40" /><br>
					</div>
					<div class="col">	
			    		<label><spring:message code="solicitud.tutor.CodigoPostal"/>:</label>
			    		<input class="form-control" type="text" id="codigoPostalTutor" name="codigoPostalTutor" value="<%=tutor.getCodigoPostal() %>" size="30" maxlength="20" /><br>
			    		<label><spring:message code="adm.Pais"/>:</label>
			      		<select class="form-select selectpicker" id="nacPais" name="nacPais" data-live-search="true" onchange="cambioPais();">
<%							for(CatPais pais : lisPais){%>
	         				<option value="<%=pais.getPaisId() %>" <%=pais.getPaisId().equals(tutor.getPaisId()) ? "Selected" : ""%>><%=pais.getNombrePais() %></option>
<%							}%>
	      				</select><br>
	      				<div id="divMexico">
		      				<label><spring:message code="solicitud.tutor.EstadoProvincia"/></label>
	      					<select class="form-select" id="nacEdo" name="nacEdo">
<%									String estadoID = tutor.getEstadoId().equals("0") ? "19" : tutor.getEstadoId();
								if (lisEstados.size()>0){						
									for(CatEstado estado : lisEstados){
										String elegir = estado.getEstadoId().equals(estadoID)?" selected":"";  
										out.print("<option value='"+estado.getEstadoId()+"' "+elegir+">"+estado.getNombreEstado()+"</option>");
									}	
								}else{
									out.print("<option value='0'>Sin registrar...</option>");
								}%>
							</select><br>
	      				 	<label><spring:message code="adm.Ciudad"/>:</label>
			      			<select class="form-select" id="nacCiudad" name="nacCiudad" >
<%								String ciudadId = tutor.getCiudadId().equals("0") ? "38" : tutor.getCiudadId();
							if (lisCiudades.size()>0){
								for(CatCiudad ciudad : lisCiudades){
									String elegir = ciudad.getCiudadId().equals(ciudadId)?" selected":"";%>
									<option value="<%=ciudad.getCiudadId()%>" <%=ciudad.getCiudadId().equals(tutor.getCiudadId())?"Selected":"" %>><%=ciudad.getNombreCiudad()%></option>
<%
								}	
							}else{
								out.print("<option value='0'>Sin registrar...</option>");
							}%>					
      							</select><br>
	      				</div>
	      				<div id="divNoMexico">
					    	<label><spring:message code="solicitud.tutor.EstadoProvincia"/></label>
					   	  	<input class="form-control" type="text" id="Estado" name="Estado" value="<%=tutor.getEstado()==null||tutor.getEstado().trim().equals("")? "" : tutor.getEstado()%>" size="30" maxlength="40" /><br>
		       				<label><spring:message code="adm.Ciudad"/>:</label>
			   	 			<input class="form-control" type="text" id="Ciudad" name="Ciudad" value="<%=tutor.getCiudad()==null||tutor.getCiudad().trim().equals("")? "" : tutor.getCiudad()%>" size="30" maxlength="40" /><br>
						</div>
		   	 			<label><spring:message code="adm.Telefono"/>:</label>
			    		<input class="form-control" type="text" id="telefonoTutor" name="telefonoTutor" value="<%=tutor.getTelefono() %>" size="20" maxlength="70"  onKeypress="if (event.keyCode<48||event.keyCode>57)event.returnValue=false;"/><br>
					</div>
				</div>
<%				if(solicitud.getEstado().equals("1")){ %>	
		    		<button type="button" class="btn alert-info" onclick="grabar();">
 						<spring:message code="adm.Guardar"/> <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>
					</button>
<%				}%>
			</form>
		</div>
	</div>
</div>
</body>
<script>
	jQuery(document).ready(function(){
		
		$("#nacPais").change(function(){
	    	var pais = $('#nacPais').val();
	    	var parametros = {Accion:'5',paisId:pais};
			$("#nacEdo").load("solicitudAccion",parametros);
			$("#nacCiudad").empty();
			$("#nacCiudad").append("<option value='0'>Elige...</option>");
		});
		
		$("#nacEdo").change(function(){
			var pais 		= $('#nacPais').val();
			var estado 		= $('#nacEdo').val();
	    	var parametros 	= {Accion:'6',paisId:pais,estadoId:estado};
			$("#nacCiudad").load("solicitudAccion",parametros);
		});
	});
</script>	
</html>
<% if (grabo.equals("S")){%>
	<table align="center"><tr><td><spring:message code="solicitud.tutor.Grabo"/></td></tr></table>
	<% if(!academico.getCarreraId().equals("10501") && !solicitud.getPaisId().equals("108") && !academico.getNivelId().equals("5")){%>
	<meta http-equiv="refresh" content="1;url=recomendaciones" />
	<% }else{%>
	<meta http-equiv="refresh" content="1;url=confirmar" />
	<% }%>
<%}else if(grabo.equals("N")){%>
	<table align="center"><tr><td><spring:message code="solicitud.tutor.NoGrabo"/></td></tr></table>
<%}%>