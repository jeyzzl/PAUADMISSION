 <%@ page import="java.util.List" %>
<%@ page import="java.util.HashMap" %>
<%@ page import="adm.alumno.spring.AdmPaso" %>
<%@ page import="adm.alumno.spring.AdmAcademico" %>
<%@ page import="adm.alumno.spring.AdmUsuario" %>
<%@ page import="adm.alumno.spring.AdmSolicitud" %>
<%@ page import="adm.catalogo.spring.CatCarrera" %>

<%@ include file= "head.jsp"%>
<%@ include file= "menu.jsp"%>
<html>
<head>
	<link rel="STYLESHEET" href="/admision.css"  type="text/css">
	<script src="js/jquery-1.5.1.min.js" type="text/javascript"></script>		
	<style>
		body{
			background-image: url("imagenes/Biblioteca.png");
			/* Para dejar la imagen de fondo centrada, vertical y horizontalmente */
			background-position: center center;
			/* La imagen se fija en la ventana de visualizaci�n para que la altura de la imagen no supere a la del contenido */
			background-attachment: fixed;
			background-repeat: no-repeat;
			/* La imagen de fondo se reescala autom�ticamente con el cambio del ancho de ventana del navegador */
			background-size: cover;
		}
		a {text-decoration: none;}
		a:hover {text-decoration: underline;}		

		@media (min-width: 587px) {
			.col-md-3{
				float: center;
				margin-left: 85px;
			}
		}
		@media (min-width: 764px) {
			.col-md-3{
				float: center;
				margin-left: 85px;
			}
		}
		@media (min-width: 480px) {
			.col-md-5{
				float: left;
				margin-left: 85px;
			}
		}
		/* Color Daisy Bush #5b3e90; rgb(83,38,163) */
	</style>
	<title>Home</title>
</head>
<%
	AdmUsuario admUsuario 				= (AdmUsuario) request.getAttribute("admUsuario");
	boolean existeMatricula				= (boolean)request.getAttribute("existeMatricula");
	boolean existeUsuario				= (boolean)request.getAttribute("existeUsuario");
	
	List<AdmSolicitud> lisSolicitudes 							= (List<AdmSolicitud>)request.getAttribute("lisSolicitudes");

	HashMap<String, AdmPaso> mapPaso 							= (HashMap<String, AdmPaso>)request.getAttribute("mapPaso");
	HashMap<String, AdmAcademico> mapAcademico 					= (HashMap<String, AdmAcademico>)request.getAttribute("mapAcademico");
	HashMap<String, CatCarrera> mapCarrera 						= (HashMap<String, CatCarrera>)request.getAttribute("mapCarrera");
%>
<body>
<div class="container-fluid p-0">
	<div class="container m-4 p-0">
	    <h2 class=""><b><spring:message code="inicio.solicitudesEnProceso"/></b>&nbsp;<%=existeMatricula?"<small class='text-muted fs-5'>( "+admUsuario.getMatricula()+" )</small>":""%></h2>
	<%	if (existeUsuario){%>
		<hr><a class="btn btn-primary text-decoration-none" href="crearNuevaSolicitud?UsuarioId=<%=admUsuario.getUsuarioId()%>" role="button"><spring:message code="inicio.crearNuevaSolicitud"/></a>
	<%	} %>
	</div>
	<div class="row m-4">
		<%
		String nombre = admUsuario.getNombre()+" "+(admUsuario.getApellidoPaterno()==null?" ":admUsuario.getApellidoPaterno())+" "+(admUsuario.getApellidoMaterno()==null?" ":admUsuario.getApellidoMaterno());
		String folio = "";
		String estado = "";
		String fecha = "";
		String carrera = "";
		for(AdmSolicitud solicitud : lisSolicitudes){
			folio = solicitud.getFolio();
			
			// ?????
			
			if(mapPaso.containsKey(solicitud.getEstado())){
				estado = mapPaso.get(solicitud.getEstado()).getNombre();
			}else{
				estado = "Not assigned";
			}
			fecha = solicitud.getFecha();
			if(mapAcademico.containsKey(solicitud.getFolio())){
				if(mapCarrera.containsKey(mapAcademico.get(solicitud.getFolio()).getCarreraId())){
					carrera = mapCarrera.get(mapAcademico.get(solicitud.getFolio()).getCarreraId()).getNombreCarrera();
				}
			}else{
				carrera = "Not assigned";
			}%>
		<div class="card border-dark w-25 p-0 me-4" style="min-width: 23rem;">
			<h5 class="card-header"><spring:message code="adm.Solicitud"/> #<%=folio%></h5>
			<div class="card-body">
				<h6 class="card-title"><b><%=nombre%></b></h6>
				<ul class="list-group mb-4">
					<li class="list-group-item"><spring:message code="inicio.fechaSolicitud"/>: <%=fecha%></li>
					<li class="list-group-item"><spring:message code="inicio.estadoSolicitud"/>:  <span class='badge rounded-pill text-dark bg-warning'><%=estado%></span></li>
					<li class="list-group-item"><spring:message code="adm.Carrera"/>: <span class='badge rounded-pill text-dark bg-warning'><%=carrera%></span></li>
				</ul>
			<a href="<%=request.getContextPath()%>/inicial?Folio=<%=folio%>" class="btn btn-info text-decoration-none me-3"><i class="fas fa-edit"></i></a>
<%		String botonBorrar = " ";
				if(mapAcademico.containsKey(solicitud.getFolio())) {
					botonBorrar = "invisible";
		}%>
			<a href="javascript:Borrar('<%=folio%>')" class="btn btn-danger text-decoration-none <%=botonBorrar%>"><i class="fas fa-trash-alt"></i></a>
			</div>
		</div>
<% } %>
 </div>
</div>
</body>
<script>
	function Borrar(folio){
		if (confirm("Are you sure you want to delete the application with ID:"+folio+" ?")){
			document.location.href="borrarSolicitud?Folio="+folio;
		}
	}
</script>
</html>