<%@page import="java.util.List"%>

<%@page import="adm.alumno.spring.AdmSolicitud"%>
<%@page import="adm.catalogo.spring.CatPais"%>
<%@page import="adm.catalogo.spring.CatEstado"%>
<%@page import="adm.catalogo.spring.CatCiudad"%>
<%@page import="adm.catalogo.spring.CatReligion"%>
<%@page import="adm.alumno.spring.AdmCartaSubir"%>

<%@ include file= "../head.jsp"%>
<%@ include file= "../menu.jsp"%>

<head> 
	<link rel="STYLESHEET" href="/admision.css"  type="text/css">
	<script src="js/jquery-1.5.1.min.js" type="text/javascript"></script>
  	<script src='js/Globo/jquery.tinyTips2.js' type='text/javascript'></script>		
	<style>		
		body{
			background-image: url("<%=request.getContextPath()%>/imagenes/Biblioteca.png");
			/* Para dejar la imagen de fondo centrada, vertical y horizontalmente */
			background-position: center center;
			/* La imagen se fija en la ventana de visualización para que la altura de la imagen no supere a la del contenido */
			background-attachment: fixed;
			background-repeat: no-repeat;
			/* La imagen de fondo se reescala automáticamente con el cambio del ancho de ventana del navegador */
			background-size: cover;	
		} 
		a {text-decoration: none;} 
		a:hover {text-decoration: underline;} 
		.tabla td{padding:5px;}
		
		.tinyTip {
			width: 325px;
			padding: 17px 0px 0px 0px;
			display: block;
			background: url(js/Globo/tinyTip-top.png) 0px 0px no-repeat;
		}
		.tinyTip .content {
			padding: 0px 15px 0px 15px;
			font-size: 14px;
			font-family: "Lucida Sans Unicode";
			color: #010101;
			background: url(js/Globo/tinyTip-content.png) 0px 0px repeat-y;
		}
		.tinyTip .bottom {
			height: 47px;
			background: url(js/Globo/tinyTip-bottom.png) 0px 0px no-repeat;
			font: 0px/0px sans-serif;
		}
		.fa{
			color: black;
		}
		a> .fa{
			color: #337ab7;
		}
		
		@media (min-width: 587px) {
			.col-md-3{
				float: left;
				margin-left: 85px;
			}
		}
		@media (min-width: 764px) {
			.col-md-3{
				float: left;
				margin-left: 0;
			}		
		}
		@media (min-width: 480px) {
			.col-md-5{
				float: left;
			}
		}	
	</style>
			
	<script type="text/javascript">
	
	window.onload = function() {
    	document.getElementById("divMexico").style.display = "block";
 		document.getElementById("divNoMexico").style.display = "none";
	};

	function revisa(){
		var fecha 		= document.getElementById("Fecha");
		var nombre 		= document.getElementById("Nombre");
		var paterno 	= document.getElementById("Paterno");
		var materno 	= document.getElementById("Materno");
		var nacPais 	= document.getElementById("nacPais");
		var nacEdo 		= document.getElementById("nacEdo");
		var nacCiudad 	= document.getElementById("nacCiudad");
		var Religion 	= document.getElementById("Religion");
		var genero	 	= document.getElementById("Genero");
		
		if(genero.value != "0"){
			if(paterno.value != ""){
				if(nombre.value != ""){
					if(nacPais.value != "0"){
						if($("Nacionalidad").value != "0"){
							if( fecha.value != ""){
								if($("EdoCivil").value != "0"){
									if(Religion.value != "0"){
										if($("Nacionalidad").value == "95"){
											if($("Curp").value!="" && $("Curp").value.match("[A-Z]{4}[0-9]{6}[H,M][A-Z]{5}[0-9,A-Z]{2}")){	
												return true;
											}else{
												alert("El curp es incorrecto");
												$("Curp").focus();	
											}
										}else{
											return true;
										}	
									}else{
										alert("La religión es requerida");
										$("Religion").focus();	
									}
								}else{
									alert("El estado civil es requerido");
									$("EdoCivil").focus();
								}
							}else{
								alert("La fecha de nacimiento es requerida");
								$("Fecha").focus();
							}
						}else{
							alert("La nacionalidad es requerida");
							$("Nacionalidad").focus();
						}
					}else{
						alert("El país de nacimiento es requerido");
						$("nacPais").focus();
					}
				}else{
					alert("El nombre es requerido");
					$("nacPais").focus();
				}
			}else{
				alert("El apellido paterno es requerido");
				$("nacPais").focus();
			}
		}else{
			alert("El genero es requerido");
		}
	
		return false;
	}
	
	function continua(){
		if(revisa()){
			document.frmDatos.submit();
		}
	}
	
	function validaFechaDDMMAAAA(fecha){
		return /^(0[1-9]|[12]\d|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d{2}$/.test(fecha);
	}

	function refreshEstados(){				
		jQuery('#nacEdo').html('<option>Actualizando</option>');		
		var paisId = $('#nacPais').val();		
		
	 	if(paisId === "91"){
		    document.getElementById("divMexico").style.display = "block";
	 		document.getElementById("divNoMexico").style.display = "none";
		}else{
			document.getElementById("nacEdo").value = "0";
			document.getElementById("nacCiudad").value = "0";

			document.getElementById("divMexico").style.display = "none";
	 		document.getElementById("divNoMexico").style.display = "block";
		}
		
		$("#nacEdo").empty();
		jQuery.get('getEstados?paisId='+paisId, function(data){
			jQuery("#nacEdo").html(data);			
			refreshCuidades();
		});		
	}

	function refreshCiudades(){
		jQuery('#nacCiudad').html('<option>Actualizando</option>');				
		var paisId 		= $('#nacPais').val();
		var estadoId 	= $('#nacEdo').val();				
		jQuery.get('getCiudades?paisId='+paisId+'&estadoId='+estadoId, function(data){
			jQuery("#nacCiudad").html(data);
		});
	}
		
	</script>
</head>
<% 	
	String folio 			= (String)session.getAttribute("Folio")==null?"0":(String)session.getAttribute("Folio");
	String grabo 			= request.getParameter("Grabo") == null ? "-" : request.getParameter("Grabo");
	String usuario			= (String)session.getAttribute("Usuario");
	boolean existePersonal	= (boolean)request.getAttribute("existePersonal");
	String colorGrabar		= existePersonal?"style='color:purple'":"style='color:orange'";
	boolean curp			= false;
	boolean esNacional		= false;	

	AdmSolicitud admSolicitud 		= (AdmSolicitud) request.getAttribute("admSolicitud");	
	AdmCartaSubir admCartaSubir 	= (AdmCartaSubir)request.getAttribute("admCartaSubir");
	
	// Valida la nacionalidad
	if (admSolicitud.getNacionalidad().equals("91") || admSolicitud.getPaisId().equals("91") || admSolicitud.getPaisId().equals("0")){
		esNacional = true;
	}
	
	// Valida CURP
	if ( (esNacional && adm.alumno.AdmSolicitud.validarCurp( admSolicitud.getCurp() ) ) || !esNacional ){		
		curp = true;
	}
	
	List<CatPais> lisPais	= (List<CatPais>) request.getAttribute("lisPais");
	List<CatEstado> lisEstados	= (List<CatEstado>) request.getAttribute("lisEstados");
	List<CatCiudad> lisCiudades	= (List<CatCiudad>) request.getAttribute("lisCiudades");
	List<CatReligion> lisReligion	= (List<CatReligion>) request.getAttribute("lisReligion");
	
	CatPais paisCero = new CatPais();
	paisCero.setPaisId("0");
	paisCero.setNombrePais("ELIGE ...");
	
	lisPais.add(0, paisCero);
	
	CatEstado estadoCero = new CatEstado();
	estadoCero.setEstadoId("0");
	estadoCero.setNombreEstado("ELIGE ...");
	
	lisEstados.add(0, estadoCero);
	
	CatCiudad ciudadCero = new CatCiudad();
	ciudadCero.setCiudadId("0");
	ciudadCero.setNombreCiudad("ELIGE ...");
	
	lisCiudades.add(0, ciudadCero);
	
	CatReligion religionCero = new CatReligion();
	religionCero.setReligionId("0");
	religionCero.setNombreReligion("ELIGE ...");
	
	lisReligion.add(0, religionCero);
%>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-1" style="background-color:rgba(255, 255, 255, 0.7);">
				<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/registro" style="color:black">					
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Datos usuario"><i class="fas fa-user fa-2x"></i><br>Cuenta</span>&nbsp;
					</a>
				</span>
				<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/solicitud/modalidad" style="color:black">					
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Solicitud de admisi�n"><i class="far fa-file-alt fa-2x"></i><br>Solicitud</span>&nbsp;
					</a>
				</span>			
				<span class="btn btn-outline-light" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/documentos/documentos" style="color:black">					
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Documentos de ingreso"><i class="fas fa-tasks fa-2x"></i><br>Documentos</span>&nbsp;
					</a>
				</span>					
				<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/directo/ingreso" style="color:black">
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Ingreso directo"><i class="fas fa-door-open fa-2x"></i><br>Ingreso</span>&nbsp;
					</a>
				</span>					
				<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/referencias?Folio=<%=folio%>" style="color:black">
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Pago en linea"><i class="fas fa-credit-card fa-2x"></i><br>Pago</span>&nbsp;
					</a>
				</span>					
				<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/cita/evento" style="color:black">
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Reservar examen"><i class="far fa-calendar-alt fa-2x"></i><br>Examen</span>&nbsp;
					</a>
				</span>					
				<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
					<a href="<%=request.getContextPath()%>/resultados/resultados" style="color:black">
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Resultados examen"><i class="fas fa-trophy fa-2x"></i><br>Resultados</span>&nbsp;
					</a>
				</span>					
				<span class="btn btn-outline-light tip" style="width: 100px; font-size: 13px;">
<% 				String colorCarta = "black";
				if(admCartaSubir.getCarta() != null){	
					colorCarta = "green";										
 				}%>	
					<a href="<%=request.getContextPath()%>/descargarCartaAdmision" style="color:<%=colorCarta%>">
						<span data-bs-toggle="tooltip" data-bs-placement="right" title="Carta de admisi&oacute;n"><i class="fas fa-envelope fa-2x"></i><br>Carta</span>&nbsp;
					</a>
				</span>					
			</div>
			<div class="col-lg-11" style="background-color:white; min-height:calc(100vh - 37px);">
				<div class="d-flex bd-highlight page-header">
					<div class="p-2 w-100 bd-highlight">
						<h2><i class="fas fa-check-circle" aria-hidden="true" <%=colorGrabar%>></i>&nbsp;<spring:message code="solicitud.datos.DatosPersonales"/></h2>
					</div>
			  		<div class="p-2 flex-shrink-1 bd-highlight">
						<div class="d-flex align-items-center">
				    		<a href="<%=request.getContextPath()%>/solicitud/modalidad" style="color:black"><i class="fas fa-caret-left fa-3x"></i></a>
				    		&nbsp;<b class="fs-5">2/8</b>&nbsp;
<%				if(  existePersonal ){%>
				    		<a href="<%=request.getContextPath()%>/solicitud/padres"><i class="fas fa-caret-right fa-3x"></i></a>
<%				}else{out.print("&nbsp;");}%>
						</div>
					</div>
				</div>
				<div class="alert alert-info" role="alert">
					<spring:message code="solicitud.datos.Precision"/>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<%-- 			<a href="https://www.gob.mx/curp" target="_blank"><spring:message code="solicitud.datos.ConsultaCurp"/></a></label> --%>
				</div>
				<div class="well">
					<form id="frmDatos" name="frmDatos" action="graboDatos" method="post">
						<div class="row">	
							<div class="col-md-4">
								<label><spring:message code="adm.Nombres"/></label>	
								<input  class= "form-control" type="text" id="Nombre" name="Nombre" value="<%= admSolicitud.getNombre()%>" size="40" maxlength="70" /><br>
			  					<label><spring:message code="solicitud.datos.PrimerApellido"/></label>
			    		 		<input  class= "form-control" type="text" id="Paterno" name="Paterno" value="<%= admSolicitud.getApellidoPaterno()%>" size="40" maxlength="70" /><br>
			    				<label><spring:message code="solicitud.datos.SegundoApellido"/></label><br><font size="1"><spring:message code="solicitud.datos.figuraCertificado"/></font></b></td>
<% 							String materno="";
							if(admSolicitud.getApellidoMaterno()!=null){
								materno = admSolicitud.getApellidoMaterno();
							} %>       
								<input  class= "form-control" type="text" id="Materno" name="Materno" value="<%=materno%>" size="40" maxlength="70" /><br>
			    				<label><spring:message code="solicitud.datos.PaisNacimiento"/></label>	    		
			      				<select class="form-select selectpicker" id="nacPais" name="nacPais" onChange="javascript:refreshEstados();" data-live-search="true">
<%								for(CatPais pais : lisPais){%>
			         				<option value="<%=pais.getPaisId()%>" <%=admSolicitud.getPaisId().equals(pais.getPaisId()) ? "selected" : ""%>><%=pais.getNombrePais() %></option>
<%								} %>
			      				</select><br>
								<div id="divMexico">
				      				<label><spring:message code="solicitud.datos.EstadoNacimiento"/></label>
				      				<select class="form-select" id="nacEdo" name="nacEdo" onChange="refreshCiudades();">
	<%								      				
									if (lisEstados.size()>0){						
										for(CatEstado estado : lisEstados){
	%>
				         				<option value="<%=estado.getEstadoId()%>" <%=admSolicitud.getEstadoId().equals(estado.getEstadoId()) ? "selected" : ""%>><%=estado.getNombreEstado()%></option>
	<%								      				
										}	
									}else{
										out.print("<option value='0'>¡Sin registrar!</option>");
									}
	%>					
				      				</select><br>
				      				<label><spring:message code="solicitud.datos.CiudadNacimiento"/></label>
				       				<select class="form-select" id="nacCiudad" name="nacCiudad">
	<%												      			
									if (lisCiudades.size()>0){
										for(CatCiudad ciudad : lisCiudades){
	%>					
				         				<option value="<%=ciudad.getCiudadId()%>" <%=admSolicitud.getCiudadId().equals(ciudad.getCiudadId()) ? "selected" : ""%>><%=ciudad.getNombreCiudad()%></option>
	<%												      			
										}	
									}else{
										out.print("<option value='0'>¡Sin registrar!</option>");
									}%>					
				       				</select>
								</div>
								<div id="divNoMexico">
									<label><spring:message code="solicitud.datos.EstadoNacimiento"/></label>
									* No es requerido<br>
				      				<label><spring:message code="solicitud.datos.CiudadNacimiento"/></label>
									* No es requerida<br>
								</div>
							</div>
							<div class="col-md-4">
			       				<label><spring:message code="adm.Nacionalidad"/></label>
			       				<select class="form-select selectpicker" id="Nacionalidad" name="Nacionalidad" data-live-search="true">
<%								String nacionalidadId = "91";
								if(admSolicitud.getNacionalidad()!=null && !admSolicitud.getNacionalidad().equals("")){
									nacionalidadId = admSolicitud.getNacionalidad();
								}
								for(CatPais pais : lisPais){%>
				         			<option value="<%=pais.getPaisId() %>" <%= pais.getPaisId().equals(nacionalidadId)?"Selected":"" %>><%=pais.getNacionalidad() %></option>
<%								} %>
			       				</select><br>
			       				<label><spring:message code="solicitud.datos.FechaNacimiento"/></label>
				   				<input class="form-control" id="Fecha"  name="Fecha" type="text" data-date-format="dd/mm/yyyy" maxlength="10" value="<% if(admSolicitud.getFechaNac()!=null) out.print(admSolicitud.getFechaNac());%>" required><br>
				   				<a href="ayudacalendario" target="_blank"><i class="fa fa-question-circle fa-2x" aria-hidden="true" ></i></a>
			     				<b>(DD/MM/AAAA)</b><br><br>
			     				<label><spring:message code="solicitud.datos.EstadoCivil"/></label>
			       				<select class="form-select" id="EdoCivil" name="EdoCivil">
<%								String estadoCivil = admSolicitud.getEstadoCivil()==null || admSolicitud.getEstadoCivil().equals("")?"S":admSolicitud.getEstadoCivil(); %>
						         	<option value="C" <%=estadoCivil.equals("C")?"Selected":"" %>>Casado</option>
							        <option value="S" <%=estadoCivil.equals("S")?"Selected":"" %>>Soltero</option>
							        <option value="V" <%=estadoCivil.equals("V")?"Selected":"" %>>Viudo</option>
							        <option value="D" <%=estadoCivil.equals("D")?"Selected":"" %>>Divorciado</option>
			       				</select><br>
			       				<label><spring:message code="adm.Sexo"/></label><br>
			       				<select class="form-select" id="Genero" name="Genero">
						         	<option value="0" <%=admSolicitud.getGenero().equals("0")?"Selected":"" %>>ELIGE ...</option>
						         	<option value="M" <%=admSolicitud.getGenero().equals("M")?"Selected":"" %>><spring:message code="adm.Masculino"/></option>
						         	<option value="F" <%=admSolicitud.getGenero().equals("F")?"Selected":"" %>><spring:message code="adm.Femenino"/></option>
			       				</select><br>
				     			<label><spring:message code="adm.Religion"/> </label><br> 
				       			<select class="form-select" id="Religion" name="Religion">
<%								for(CatReligion religion : lisReligion){%>
				         			<option value="<%=religion.getReligionId()%>" <%= admSolicitud.getReligionId().equals(religion.getReligionId())?"Selected":"" %>><%=religion.getNombreReligion()%></option>
<%								} %>
			        			</select><br>
								<input type="hidden" value="N" id="Bautizado" name="Bautizado">
							</div>	
						</div><br>
<%		if(admSolicitud.getEstado().equals("1")){ %>	
						<button type="button" class="btn alert-info" onclick="continua()">
							<spring:message code="adm.Guardar"/> <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>&nbsp;
						</button>
<%		} %>	
					</form>	
				</div>
			</div>
		</div>
	</div>
</body>
<script>	
	jQuery('#Fecha').datepicker();
</script>
<%	if (grabo.equals("SI") && ( (esNacional) || (!esNacional) ) ){%>	
	<table align='center'><tr><td><spring:message code="solicitud.datos.GraboDatos"/></td></tr></table>
	<meta http-equiv="refresh" content="1;url=padres" />
<%	}else if(grabo.equals("NO")){%>	
		<table align='center'><tr><td><spring:message code="solicitud.datos.NoGraboDatos"/></td></tr></table>
<%	}%>