<%@page import="java.util.List"%>
<%@page import="java.util.HashMap"%>
<%@page import="adm.alumno.spring.AdmSolicitud"%>
<%@page import="adm.alumno.spring.AdmAcademico"%>
<%@page import="adm.alumno.spring.AdmEstudio"%>
<%@page import="adm.documento.spring.AdmFormato"%>
<%@page import="adm.documento.spring.AdmDocumento"%>
<%@page import="adm.documento.spring.AdmDocAlum"%>
<%@page import="adm.documento.spring.AdmRequisito"%>
<%@page import="adm.alumno.spring.AdmCartaSubir"%>

<%@ include file= "../head.jsp"%>
<%@ include file= "../menu.jsp"%>
<%
	String folio 			= (String)session.getAttribute("Folio")==null?"0":(String)session.getAttribute("Folio");
	List<String> opciones	= (List<String>)session.getAttribute("Opciones");
	String colorImagen 		= "bg-warning";
	String colorArchivo		= "style='color:#ff9633'";	
	
	AdmSolicitud admSolicitud		= (AdmSolicitud)request.getAttribute("admSolicitud");
	AdmAcademico admAcademico		= (AdmAcademico)request.getAttribute("admAcademico");	
	AdmCartaSubir admCartaSubir 	= (AdmCartaSubir)request.getAttribute("admCartaSubir");
	
	String nivelNombre		= (String)request.getAttribute("nivelNombre");
	String carreraNombre	= (String)request.getAttribute("carreraNombre");	 
	String modalidad 		= admAcademico.getModalidad();
	
	List<AdmRequisito> lisRequisitos 				= (List<AdmRequisito>)request.getAttribute("lisRequisitos"); 
	HashMap<String, AdmDocumento> mapDocumentos		= (HashMap<String,AdmDocumento>)request.getAttribute("mapDocumentos");
	HashMap<String, AdmDocAlum> mapDocAlum			= (HashMap<String,AdmDocAlum>)request.getAttribute("mapDocAlum");
	HashMap<String, AdmFormato> mapFormatos			= (HashMap<String,AdmFormato>)request.getAttribute("mapFormatos");
	HashMap<String, String> mapImagen				= (HashMap<String,String>)request.getAttribute("mapImagen");	
	HashMap<String, String> mapArchivo				= (HashMap<String,String>)request.getAttribute("mapArchivo");
%>
<head>
	<link rel="STYLESHEET" href="/admision.css"  type="text/css">
	<script src="../../js/jquery-1.5.1.min.js" type="text/javascript"></script>
  	<script src='../../js/Globo/jquery.tinyTips2.js' type='text/javascript'></script>		
	<style>		
		body{
			background-image: url("<%=request.getContextPath()%>/imagenes/Biblioteca.png");
			/* Para dejar la imagen de fondo centrada, vertical y horizontalmente */
			background-position: center center;
			/* La imagen se fija en la ventana de visualización para que la altura de la imagen no supere a la del contenido */
			background-attachment: fixed;
			background-repeat: no-repeat;
			/* La imagen de fondo se reescala automáticamente con el cambio del ancho de ventana del navegador */
			background-size: cover;	
		} 
		a {text-decoration: none;} 
		a:hover {text-decoration: underline;} 
		.tabla td{padding:5px;}
		
		.tinyTip {
			width: 325px;
			padding: 17px 0px 0px 0px;
			display: block;
			background: url(js/Globo/tinyTip-top.png) 0px 0px no-repeat;
		}
		.tinyTip .content {
			padding: 0px 15px 0px 15px;
			font-size: 14px;
			font-family: "Lucida Sans Unicode";
			color: #010101;
			background: url(js/Globo/tinyTip-content.png) 0px 0px repeat-y;
		}
		.tinyTip .bottom {
			height: 47px;
			background: url(js/Globo/tinyTip-bottom.png) 0px 0px no-repeat;
			font: 0px/0px sans-serif;
		}
		.fa{
			color: black;
		}
		a> .fa{
			color: #337ab7;
		}
		
		@media (min-width: 587px) {
			.col-md-3{
				float: left;
				margin-left: 85px;
			}
		}
		@media (min-width: 764px) {
			.col-md-3{
				float: left;
				margin-left: 0;
			}		
		}
		@media (min-width: 480px) {
			.col-md-5{
				float: left;
			}
		}	
	</style>		
</head>
<body>	
<div class="container-fluid">
	<div class="row">
		<%@ include file= "../opciones.jsp"%>
		<div class="col-lg-11" style="background-color:white; min-height:calc(100vh - 37px);">
			<div class="page-header">
			  <h2><spring:message code='documentos.documentos.RequisitosAdmision'/><small class="text-muted fs-5">( <%=nivelNombre%> &nbsp;<spring:message code='documentos.documentos.Carrera'/>: <i><%=carreraNombre%></i> )</small></h2>
			</div>
			<div class="alert alert-info" role="alert">
<%				 if(admSolicitud.getEstado().equals("2")){%>
					<spring:message code='documentos.documentos.DocumentosDigitalizados'/>&nbsp;					
					<spring:message code='documentos.documentos.EnviarArchivo'/><i class="fa fa-upload fa-1x" style='color:#ff9633'></i> <br><spring:message code='documentos.documentos.FormatoQueLlenar'/>
					<i class="fa fa-download fa-1x" style="color:#6487cb"></i>
					<spring:message code='documentos.documentos.PosteriormenteEnviarlo'/><br>			
<%				}else if (admSolicitud.getEstado().equals("3") || admSolicitud.getEstado().equals("4")){%>
					<h4 align="center"><font color="green"><b><spring:message code='documentos.documentos.DocumentosAutorizados'/></b></font></h4>
<%				}else{
					out.print("<h4>You must complete your application before uploading any documents</h4>");
				}
%>
			</div>
			<div class="row">
				<div class="col-md-12">		
<%-- <%				 if(admSolicitud.getEstado().equals("2")){%>
					<spring:message code='documentos.documentos.DocumentosDigitalizados'/>&nbsp;					
					<spring:message code='documentos.documentos.EnviarArchivo'/><i class="fa fa-upload fa-1x" style='color:#ff9633'></i> <br><spring:message code='documentos.documentos.FormatoQueLlenar'/>
					<i class="fa fa-download fa-1x" style="color:#6487cb"></i>
					<spring:message code='documentos.documentos.PosteriormenteEnviarlo'/><br><br>			
<%				}else if (admSolicitud.getEstado().equals("3") || admSolicitud.getEstado().equals("4")){%>
					<h4 align="center"><font color="green"><b><spring:message code='documentos.documentos.DocumentosAutorizados'/></b></font></h4>
<%				}else{
					out.print("<h4>You must complete your application before uploading any documents</h4>");
				}
%> --%>
				</div>
			</div>	
			<table class="table table-responsive table-sm table-bordered">
			<thead>
			<tr class="table-dark">
				<th width="3%"><b>#</b></th>
				<th width="3%" class="text-center"><b>?</b></th>
				<th width="45%"><b><spring:message code='documentos.documentos.Documento'/></b></th>
				<th width="5%" class="text-center"><b>PDF</b></th>
				<th width="4%"><b><spring:message code='documentos.documentos.Formato'/></b></th>
				<th width="10%"><b><spring:message code='documentos.documentos.Estado'/></b></th>	
				<th width="25%"><b><spring:message code='documentos.documentos.Comentario'/></b></th>			
			</tr>
			</thead>
			<tbody style="background-color:white">				
<%		int cont = 0;
		for(AdmRequisito requisito : lisRequisitos){				
			boolean existeModalidad = false;		
			String [] modalidades = requisito.getModalidades().split("-");		
			for(String mod : modalidades){			
				if(mod.equals(modalidad)){
					existeModalidad = true;
					break;
				}
			}
				
			if(!existeModalidad) continue; else cont++;				
			AdmDocAlum docAlum = new AdmDocAlum(); 
			boolean existeDocAlum = false;
			boolean enviar = true;
			if (mapDocAlum.containsKey(folio+requisito.getDocumentoId())){
				docAlum = mapDocAlum.get(folio+requisito.getDocumentoId());
				existeDocAlum = true;				
			}	
			if(existeDocAlum && docAlum.getEstado().equals("A")){
				enviar = false;
			}
				
			AdmDocumento documento 	= new AdmDocumento();
			AdmFormato formato 		= new AdmFormato();
			boolean existeFormato 	= false;
			if (mapDocumentos.containsKey(requisito.getDocumentoId())){
				documento = mapDocumentos.get(requisito.getDocumentoId());
				if (mapFormatos.containsKey(documento.getFormatoId())){
					formato = mapFormatos.get(documento.getFormatoId());
					existeFormato = true;
				}
			}				
			if(requisito.getRequerido().equals("N"))continue;
%>	
			<tr>
				<td><%=cont%></td>
				<td class="text-center"><i class="fa fa-comment fa-1x globo" aria-hidden="true" title="<%=(documento.getComentario()==null||documento.getComentario().equals("-")) ? "<i>No comment</i>" : documento.getComentario()%>"></i></td>
				<td>						
					<%=documento.getDocumentoNombre()%>			
				</td>
				<td class="text-center">
<%					if (mapArchivo.containsKey(folio+documento.getDocumentoId())) colorArchivo = ""; else colorArchivo = "style='color:#ff9633'"; %>
					<a href="archivo?documentoId=<%=documento.getDocumentoId()%>"><i class="fas fa-upload fa-1x" <%=colorArchivo%>></i></a>					
				</td>	
				<td>			
<%				if (existeFormato){ %>					
					<h5 Style="margin-top:3px;"><%=formato.getFormatoNombre()%>
<%					if(admSolicitud.getEstado().equals("2") && enviar){ %>
						<a target="_black" href="<%=formato.getArchivo() %>">
							<i class="fas fa-download fa-1x"></i>
						</a>
<%					} %>
					</h5>
<%				} %>			
				</td>
				<td>
<%					if(!existeDocAlum){ %>  				
					<i class="fa fa-exclamation-circle fa-1x"></i>&nbsp;
					<spring:message code='documentos.documentos.NoEnviado'/>
<%					}else if(docAlum.getEstado().equals("E")){ %>
					<img src="../imagenes/sandClock.png" height="15px">&nbsp;
					<spring:message code='documentos.documentos.EsperandoAprobacion'/>
<%					}else if(docAlum.getEstado().equals("A")){ %>
					<i class="fas fa-check-square fa-1x"></i>&nbsp;
					<spring:message code='documentos.documentos.Aprobado'/>				
<%					}else if(docAlum.getEstado().equals("N")){ %>
					<spring:message code='documentos.documentos.NoAprobado'/>
<%					}%>
				</td>
				<td>			
<%				if(existeDocAlum && docAlum.getComentario()!=null && !docAlum.getComentario().equals("null") && !docAlum.getComentario().equals("-")){
					out.print(docAlum.getComentario());
				}%>			
				</td>				
			</tr>				
<%		}%>	
			</tbody>
			</table>
		</div>
	</div>
</div>		
</body>