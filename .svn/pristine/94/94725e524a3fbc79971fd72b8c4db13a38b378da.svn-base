 <%@ include file= "head.jsp"%>
<%@ include file= "menu.jsp"%>

<%@page import="java.util.List"%>
<%@page import="java.util.HashMap"%>
<%@page import="adm.alumno.spring.AlumReferencia"%>
<%@page import="adm.alumno.spring.AdmCartaSubir"%>
<%@page import="adm.alumno.spring.AdmSolicitud"%>
<%@page import="adm.pago.spring.AdmPago"%>
<%@page import="adm.parametros.spring.AdmParametros"%>

<html>
	<head>
	<link rel="STYLESHEET" href="/admision.css"  type="text/css">
	<script src="js/jquery-1.5.1.min.js" type="text/javascript"></script>
  	<script src='js/Globo/jquery.tinyTips2.js' type='text/javascript'></script>		
	<style>		
		body{
			background-image: url("imagenes/Biblioteca.png");
			/* Para dejar la imagen de fondo centrada, vertical y horizontalmente */
			background-position: center center;
			/* La imagen se fija en la ventana de visualizaci�n para que la altura de la imagen no supere a la del contenido */
			background-attachment: fixed;
			background-repeat: no-repeat;
			/* La imagen de fondo se reescala autom�ticamente con el cambio del ancho de ventana del navegador */
			background-size: cover;	
		} 
		a {text-decoration: none;} 
		a:hover {text-decoration: underline;} 
		.tabla td{padding:5px;}
		
		.tinyTip {
			width: 325px;
			padding: 17px 0px 0px 0px;
			display: block;
			background: url(js/Globo/tinyTip-top.png) 0px 0px no-repeat;
		}
		.tinyTip .content {
			padding: 0px 15px 0px 15px;
			font-size: 14px;
			font-family: "Lucida Sans Unicode";
			color: #010101;
			background: url(js/Globo/tinyTip-content.png) 0px 0px repeat-y;
		}
		.tinyTip .bottom {
			height: 47px;
			background: url(js/Globo/tinyTip-bottom.png) 0px 0px no-repeat;
			font: 0px/0px sans-serif;
		}
		.fa{
			color: black;
		}
		a> .fa{
			color: #337ab7;
		}
		
		@media (min-width: 587px) {
			.col-md-3{
				float: left;
				margin-left: 85px;
			}
		}
		@media (min-width: 764px) {
			.col-md-3{
				float: left;
				margin-left: 0;
			}		
		}
		@media (min-width: 480px) {
			.col-md-5{
				float: left;
			}
		}	
	</style>		
	<script type="text/javascript">
		function ActualizarPlan(){  		
	  		document.frmPlanes.submit();
		}	

		function continua(){
			if(revisa()){
				document.frmDatos.submit();
			}
		}

		function revisa(){
			var cantidad 	= document.getElementById("Cantidad");
			var recibo 		= document.getElementById("Recibo");
			var imagen 		= document.getElementById("imagen");
			var regex 		= /^K\d+$|^\d+$/;

			if(regex.test(cantidad.value)){
				<%-- if(recibo.value != ""){ --%>
					if(imagen.files.length > 0){
						return true;
					}else{
						alert("Please upload a receipt file");
						$("Recibo").focus();
					}
				<%-- }else{
					alert("Please enter your receipt or transaction code");
					$("Recibo").focus();
				} --%>
			}else{
				alert("Please a valid ammount (ex. K20 or numeric value)");
				$("Cantidad").focus();
			}

			return false;
		}

	</script>
	</head>
<%	
	List<String> opciones	= (List<String>)session.getAttribute("Opciones");

	String folio 			= request.getParameter("Folio")==null?"0":request.getParameter("Folio");
	String grabo 			= request.getParameter("Grabo") == null ? "-" : request.getParameter("Grabo");
	String documentoId 		= request.getParameter("documentoId")==null?"0":request.getParameter("documentoId");
	
	boolean tieneRecibo		= (boolean)request.getAttribute("tieneRecibo");
	boolean tienePago		= (boolean)request.getAttribute("tienePago");
	
	List<AdmPago> lisPagos 	= (List<AdmPago>)request.getAttribute("lisPagos");
	
	AdmCartaSubir admCartaSubir = (AdmCartaSubir)request.getAttribute("admCartaSubir");
	
	AdmSolicitud admSolicitud = (AdmSolicitud)request.getAttribute("admSolicitud");
	AdmParametros admParametros = (AdmParametros)request.getAttribute("admParametros");

	String colorGrabar			= tieneRecibo?"style='color:green'":"style='color:orange'";
%>
<body>
<div class="container-fluid">
	<div class="row">
		<%-- <%@ include file= "opciones.jsp"%> --%>
		<div class="col-lg-12" style="background-color:white; min-height:calc(100vh - 37px);">		
			<div class="d-flex bd-highlight page-header">
				<div class="p-2 w-100 bd-highlight">
					<h2><i class="fas fa-check-circle" aria-hidden="true" <%=colorGrabar%>></i>&nbsp;Application Fee<small class="text-muted fs-5"></small></h2>
				</div>
				<div class="p-2 flex-shrink-1 bd-highlight">
					<div class="d-flex align-items-center">
						<a href="<%=request.getContextPath()%>/documentos/documentos"><i class="fas fa-caret-left fa-3x"></i></a>
						&nbsp;<b class="fs-5">11/12</b>&nbsp;
	<%						if(tieneRecibo){%>
						<a href="<%=request.getContextPath()%>/solicitud/confirmar"><i class="fas fa-caret-right fa-3x"></i></a>
	<% 						}else{
						out.print("&nbsp;");
					}%>
					</div>
				</div>
			</div>
			<div class="alert alert-info">
<%
			if(tieneRecibo){
%>
				Thank you for submitting your fee receipt! Your payment will be validated by the Finance Office. You will be able to download your <b>Acceptance Letter</b> when your application has been processed.
<%
			}
			else{
				if(admParametros.getInstitucion().equals("Pacific Adventist University")){ %>
					<spring:message code="solicitud.referencias.indicacion.Pau"/> <% } %>
<% 				if(admParametros.getInstitucion().equals("Sonoma")){ %>
					<spring:message code="solicitud.referencias.indicacion.Sonoma"/> <% } %>
<% 				if(admParametros.getInstitucion().equals("Fulton")){ %>				
					<spring:message code="solicitud.referencias.indicacion.Fulton"/> <% } %>
<% 			} %>
			</div>				
			<div class="col-lg-12">
			<form id="frmDatos" enctype="multipart/form-data" name="frmDatos" action="grabarPago" method="post">
				<div class="row">	
					<div class="col-md-4">
						<label>Amount Paid in PNG Kina (PGK)</label>	
						<input  class= "form-control" type="text" id="Cantidad" name="Cantidad" value="" size="40" maxlength="70" /><br>
			  			<label>Method of Payment</label>
			  			<select class="form-select" id="Metodo" name="Metodo">
							<option value="B">Bank Deposit</option>
							<option value="T">Online</option>
							<%-- <option value="C">Cash Payment</option> --%>
			       		</select>
			       		<br>
			       		<label>Receipt Number</label>
			    		<input  class= "form-control" type="text" id="Recibo" name="Recibo" value="" size="40" maxlength="70" /><br>
			    		<label>Desc</label>	
						<input  class= "form-control" type="textarea" id="Comentario" name="Comentario" placeholder="..." size="40" maxlength="70" />
						<br>	
						<!-- ---------------------- UPLOAD FILE -------------------- -->
<%-- <%					if(admSolicitud.getEstado().equals("2") || admSolicitud.getEstado().equals("3") || admSolicitud.getEstado().equals("4")){ %> --%>
<%						if(!tieneRecibo){
%>				
						<h2><b><font size="4">Upload Receipt Proof</font></b></h2>
						<div class="fileupload fileupload-new" data-provides="fileupload">	
							<span class="btn  btn-defan ult btn-file">
								<input type="file" id="imagen" name="imagen"/>
							</span>
							<br>					
						</div>	
						<br>
						<button type="button" class="btn alert-info" onclick="continua()">
							<spring:message code="adm.Guardar"/> <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span>&nbsp;
						</button>
<% 					} %>
<%-- <%				}	%> --%>
					</div> <!-- col-md-4 -->
					<div class="col-md-8">
						<br>
						<table class="table table-bordered">
							<thead class="table-dark">
								<tr>
									<th>Ammount</th>
									<th>Method</th>
									<th>Date</th>
									<th>Receipt</th>
									<th><i class="fas fa-download"></i></th>
								</tr>
							</thead>
							<tbody>
<%
	for(AdmPago pago : lisPagos){
		String metodo = "-";
		if(pago.getMetodo().equals("B")) metodo = "Bank Deposit";
		if(pago.getMetodo().equals("T")) metodo = "Transfer";
		if(pago.getMetodo().equals("C")) metodo = "Cash";
%>
								<tr>
									<th><%=pago.getCantidad()%></th>
									<th><%=metodo %></th>
									<th><%=pago.getFecha() %></th>
									<th><%=pago.getRecibo()==null?"n/a":pago.getRecibo() %></th>
									<th>
									<%
										if(tieneRecibo && !tienePago && admSolicitud.getEstado().equals("3")){
									%>
										<a href="borrarPaso?Folio=<%=folio %>&Paso=1" class="btn btn-danger"><i class="fas fa-trash"></i></a>
									<%
										}
									%>
										<a href="descargarPago?Folio=<%=folio%>" class="btn btn-primary"><i class="fas fa-download"></i></a>
									</th>
								</tr>
<%
	}
%>
							</tbody>
						</table>
					</div> <!-- col-md-8 -->
				</div> <!-- row -->
			</form>	
<%
			if(grabo.equals("SI")){
%>
				<div class="mt-4 text-success ">
					<b><spring:message code="solicitud.datos.GraboDatos"/></b>
				</div>
<%
			}
%>
			</div> <!-- col-lg-12 -->
		</div> <!-- col-lg-11 -->
	</div> <!-- row -->
<%	if (grabo.equals("SI")){%>	
	<div class="alert alert-success"><spring:message code="solicitud.datos.GraboDatos"/></div>
	<meta http-equiv="refresh" content="1;url=<%=request.getContextPath()%>/solicitud/confirmar" />
<%	}else if(grabo.equals("NO")){%>	
		<div class="alert alert-warning"><spring:message code="solicitud.datos.NoGraboDatos"/></div>
<%	}%>
</div> <!-- container-fluid -->

<script>	
	function borrarArchivo(documentoId){
		if(confirm("Are you sure you want to delete this document?")){
			document.location.href = "borrararchivo?documentoId="+documentoId;
		}
	}
</script>
	
</body>
</html>