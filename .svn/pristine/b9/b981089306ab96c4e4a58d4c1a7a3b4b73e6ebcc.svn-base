package adm.alumno.spring;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;

@Component
public class AdmUsuarioDao{
	
	@Autowired
	@Qualifier("jdbcSalomon")
	private JdbcTemplate salomonJdbc;
	
	
	public boolean insertReg(AdmUsuario admUsuario) {
		boolean ok = false;
		try{
			String comando = "INSERT INTO SALOMON.ADM_USUARIO"+ 
				"(USUARIO_ID, NOMBRE, APELLIDO_PATERNO, APELLIDO_MATERNO, FECHA_NAC, EMAIL, CUENTA, " +
				" CLAVE, MATRICULA, TELEFONO, PAIS_ID, ESTADO_ID, CIUDAD_ID, GENERO, ESTADOCIVIL, RELIGION_ID, ESTADO, CODIGO, NACIONALIDAD) "+
				"VALUES( TO_NUMBER(?,'99999'), ?, ?, ?, TO_DATE(?, 'DD/MM/YYYY'), ?, ?, ?, ?, ?, TO_NUMBER(?,'999'),TO_NUMBER(?,'999'),TO_NUMBER(?,'999'), " +
				"?, ?, TO_NUMBER(?,'99'), ?, ?, TO_NUMBER(?, '999') )";			
			Object[] parametros = new Object[] {
				admUsuario.getUsuarioId(),admUsuario.getNombre(),admUsuario.getApellidoPaterno(),admUsuario.getApellidoMaterno(),admUsuario.getFechaNac(),admUsuario.getEmail(),
				admUsuario.getCuenta(),admUsuario.getClave(),admUsuario.getMatricula(),admUsuario.getTelefono(), admUsuario.getPaisId(),admUsuario.getEstadoId(),admUsuario.getCiudadId(),
				admUsuario.getGenero(),admUsuario.getEstadoCivil(),admUsuario.getReligionId(), admUsuario.getEstado(), admUsuario.getCodigo(), admUsuario.getNacionalidad()
 		 	};
			if (salomonJdbc.update(comando,parametros)==1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|insertReg|:"+ex);
		}
		return ok;
	}	
	
	public boolean updateReg(AdmUsuario admUsuario) {
		boolean ok = false;

		try{
			String comando = "UPDATE SALOMON.ADM_USUARIO SET"
					+ " NOMBRE = ?, "
					+ " APELLIDO_PATERNO = ?, "
					+ " APELLIDO_MATERNO = ?, "
					+ " FECHA_NAC = TO_DATE(?, 'DD/MM/YYYY'), "
					+ " EMAIL = ?, "
					+ " CUENTA = ?, "
					+ " CLAVE = ?, "
					+ " MATRICULA = ?, "
					+ " TELEFONO = ?, "
					+ " PAIS_ID = TO_NUMBER(?, '999') , "
					+ " ESTADO_ID = TO_NUMBER(?, '999') , "
					+ " CIUDAD_ID = TO_NUMBER(?, '999') , "
					+ " GENERO = ?, "
					+ " ESTADOCIVIL = ?, "
					+ " RELIGION_ID = TO_NUMBER(?, '99') , "
					+ " ESTADO = ? , "
					+ " CODIGO = ? , "
					+ " NACIONALIDAD = TO_NUMBER(?, '999') "
					+ " WHERE USUARIO_ID = TO_NUMBER(?,'99999')";
			
			Object[] parametros = new Object[] {
					admUsuario.getNombre(),admUsuario.getApellidoPaterno(),admUsuario.getApellidoMaterno(),admUsuario.getFechaNac(),admUsuario.getEmail(),
					admUsuario.getCuenta(),admUsuario.getClave(),admUsuario.getMatricula(),admUsuario.getTelefono(),admUsuario.getPaisId(),admUsuario.getEstadoId(),
					admUsuario.getCiudadId(),admUsuario.getGenero(),admUsuario.getEstadoCivil(),admUsuario.getReligionId(),admUsuario.getEstado(),admUsuario.getCodigo(),admUsuario.getNacionalidad(),
					admUsuario.getUsuarioId()
 		 	};
			if (salomonJdbc.update(comando,parametros)==1){
				ok = true;
			}
			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|updateReg|:"+ex);
		}		
		return ok;
	}
	
	public boolean updateClaveUsuario(String usuarioId, String clave) {
		boolean ok = false;		
		try{
			String comando = "UPDATE SALOMON.ADM_USUARIO SET CLAVE = ? WHERE USUARIO_ID = TO_NUMBER(?,'99999')";
			Object[] parametros = new Object[] {clave, usuarioId };
			if (salomonJdbc.update(comando,parametros)==1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|updateClaveUsuario|:"+ex);
		}

		return ok;
	}	
	
	public boolean updateClave(String cuenta, String clave){
		boolean ok = false;		
		try{
			String comando = "UPDATE SALOMON.ADM_USUARIO SET CLAVE = ? WHERE CUENTA = ?";
			Object[] parametros = new Object[] { clave, cuenta };
			if (salomonJdbc.update(comando,parametros)>=1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|updateClave|:"+ex);
		}
		return ok;
	}
	
	public boolean deleteReg(String UsuarioId ) {
		boolean ok = false;
		try{
			String comando = "DELETE FROM SALOMON.ADM_USUARIO WHERE USUARIO_ID = TO_NUMBER(?,'99999')";			
			Object[] parametros = new Object[] {UsuarioId};
			if (salomonJdbc.update(comando,parametros)==1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|deleteReg|:"+ex);
		}		
		return ok;
	}
	
	public AdmUsuario mapeaRegId(String UsuarioId ) {
		AdmUsuario objeto = new AdmUsuario();		
		try {
			String comando = "SELECT USUARIO_ID, NOMBRE, APELLIDO_PATERNO, APELLIDO_MATERNO, TO_CHAR(FECHA_NAC,'DD/MM/YYYY') AS FECHA_NAC, EMAIL, CUENTA,"
					+ " CLAVE, MATRICULA, TELEFONO, PAIS_ID, ESTADO_ID, CIUDAD_ID, GENERO, ESTADOCIVIL, RELIGION_ID,"
					+ " TO_CHAR(FECHA,'YYYY/MM/DD HH24:MI:SS') AS FECHA, ESTADO, CODIGO, NACIONALIDAD"
					+ " FROM SALOMON.ADM_USUARIO"
					+ " WHERE USUARIO_ID = TO_NUMBER(?,'99999')";			
			Object[] parametros = new Object[] {UsuarioId};
			objeto = salomonJdbc.queryForObject(comando, new AdmUsuarioMapper(), parametros);			
		} catch (Exception ex) {
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|mapeaRegId|:"+ex);
		}
		
		return objeto;
	}

	public AdmUsuario mapeaRegPorUsuario(String usuario ){
		AdmUsuario objeto = new AdmUsuario();		
		try {
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO WHERE CUENTA = ?";			
			if (salomonJdbc.queryForObject(comando,Integer.class, usuario)>=1){
				comando = "SELECT USUARIO_ID, NOMBRE, APELLIDO_PATERNO, APELLIDO_MATERNO, TO_CHAR(FECHA_NAC,'DD/MM/YYYY') AS FECHA_NAC, EMAIL, CUENTA,"
				+ " CLAVE, MATRICULA, TELEFONO, PAIS_ID, ESTADO_ID, CIUDAD_ID, GENERO, ESTADOCIVIL, RELIGION_ID,"
				+ " TO_CHAR(FECHA,'YYYY/MM/DD HH24:MI:SS') AS FECHA, ESTADO, CODIGO, NACIONALIDAD"
				+ " FROM SALOMON.ADM_USUARIO"
				+ " WHERE CUENTA = ?";				
				objeto = salomonJdbc.queryForObject(comando, new AdmUsuarioMapper(), usuario);			
			}						
		} catch (Exception ex) {
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|mapeaRegPorUsuario|:"+ex);
		}		
		return objeto;
	}
	
	public boolean existeReg(String UsuarioId) {
		boolean 		ok 		= false;		
		try{
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO WHERE USUARIO_ID = TO_NUMBER(?,'99999')";			
			Object[] parametros = new Object[] {UsuarioId};
			if (salomonJdbc.queryForObject(comando,Integer.class, parametros)>=1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|existeReg|:"+ex);
		}		
		return ok;
	}
	
	public boolean existeUsuario(String cuenta, String clave) {
		boolean ok 	= false;		
		try{
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO WHERE CUENTA = ? AND CLAVE = ?";		
			Object[] parametros = new Object[] {cuenta,clave};
			if (salomonJdbc.queryForObject(comando,Integer.class, parametros)>=1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|existeUsuario|:"+ex);
		}		
		return ok;
	}
	
	public boolean existeAlumno( String codigoPersonal) {
 		boolean 		ok 	= false; 		
 		try{
 			String comando = "SELECT COUNT(CODIGO_PERSONAL) FROM ENOC.ALUM_PERSONAL WHERE CODIGO_PERSONAL = ? ";
 			Object[] parametros = new Object[] {codigoPersonal};
 			if (salomonJdbc.queryForObject(comando, Integer.class, parametros) >= 1){
				ok = true;
			}			
 		}catch(Exception ex){
 			System.out.println("Error - aca.alumno.spring.AdmUsuarioDao|existeAlumno|:"+ex);
 		} 		
 		return ok;
 	}
	
	public String getUsuarioId(String cuenta, String clave) {
		String usuarioId = "0";		
		try{
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO WHERE CUENTA = ? AND CLAVE = ?";			
			if (salomonJdbc.queryForObject(comando,Integer.class, cuenta,clave)>=1){
				comando = "SELECT USUARIO_ID FROM SALOMON.ADM_USUARIO WHERE CUENTA = ? AND CLAVE = ?";
				usuarioId = salomonJdbc.queryForObject(comando,String.class, cuenta,clave);
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|getUsuarioId|:"+ex);
		}		
		return usuarioId;
	}
	
	public String getNombreCorto(String folio){
		String nombre = "X";		
		try{
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO WHERE USUARIO_ID = TO_NUMBER(?,'99999')";			
			if (salomonJdbc.queryForObject(comando,Integer.class, folio)>=1){
				comando = "SELECT NOMBRE||' '||APELLIDO_PATERNO AS NOMBRE FROM SALOMON.ADM_USUARIO WHERE USUARIO_ID = TO_NUMBER(?,'99999')";
				nombre = salomonJdbc.queryForObject(comando,String.class, folio);
			}						
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|getNombreCorto|:"+ex);
		}		
		return nombre;
	}
	
	public boolean existeCuenta(String Cuenta) {
		boolean 		ok 		= false;		
		try{
			String comando = "SELECT COUNT(*) FROM SALOMON.ADM_USUARIO "+ 
					" WHERE CUENTA = ?";			
			Object[] parametros = new Object[] {Cuenta};
			if (salomonJdbc.queryForObject(comando,Integer.class, parametros)>=1){
				ok = true;
			}			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|existeCuenta|:"+ex);
		}		
		return ok;
	}
	
	public String maximoReg() {
		String usuarioId = "1";		
		try{
			String comando = "SELECT COALESCE(MAX(USUARIO_ID), 0)+1 AS MAXIMO FROM SALOMON.ADM_USUARIO";			
			usuarioId = salomonJdbc.queryForObject(comando,String.class);			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.spring.AdmUsuarioDao|maximoReg|:"+ex);
		}
		
		return usuarioId;
	}
	
	public List<AdmUsuario> lisTodos(String orden) {
		List<AdmUsuario> lista		= new ArrayList<AdmUsuario>();		
		try{
			String comando = "SELECT USUARIO_ID, NOMBRE, APELLIDO_PATERNO, APELLIDO_MATERNO, FECHA_NAC, EMAIL, CUENTA," +
					" CLAVE, MATRICULA, TELEFONO, PAIS_ID, ESTADO_ID, CIUDAD_ID, GENERO, ESTADOCIVIL, RELIGION_ID, TO_CHAR(FECHA,'YYYY/MM/DD HH24:MI:SS') AS FECHA, ESTADO, CODIGO, NACIONALIDAD " +
					" FROM SALOMON.ADM_USUARIO "+ orden;			
			lista = salomonJdbc.query(comando, new AdmUsuarioMapper());			
		}catch(Exception ex){
			System.out.println("Error - adm.alumno.AdmUsuarioUtil|lisTodos|:"+ex);
		}		
		return lista;
	}	
}